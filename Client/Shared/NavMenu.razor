@inject CartService CartService
@inject NavigationManager Navigation
@using ETechEnergie.Client.Services
@implements IDisposable

<nav class="navbar">
    <div class="nav-container">
        <a href="/" class="nav-brand">
            <img src="/images/logo.png" alt="e-Tech Energie+" class="nav-logo" />
        </a>

        <button class="nav-toggle" @onclick="ToggleNavMenu">
            <i class="fas @(collapseNavMenu ? "fa-bars" : "fa-times")"></i>
        </button>

        <div class="nav-menu @NavMenuCssClass">
            <a href="/" class="nav-link" @onclick="CloseNavMenu">
                <i class="fas fa-home"></i> Accueil
            </a>
            <a href="/services" class="nav-link" @onclick="CloseNavMenu">
                <i class="fas fa-cogs"></i> Services
            </a>
            <a href="/products" class="nav-link" @onclick="CloseNavMenu">
                <i class="fas fa-shopping-bag"></i> Produits
            </a>
            <a href="/about" class="nav-link" @onclick="CloseNavMenu">
                <i class="fas fa-info-circle"></i> Ã€ Propos
            </a>
            <a href="/contact" class="nav-link" @onclick="CloseNavMenu">
                <i class="fas fa-envelope"></i> Contact
            </a>
            <a href="/cart" class="nav-link cart-link" @onclick="CloseNavMenu">
                <i class="fas fa-shopping-cart"></i>
                Panier
                
@if(cartItemCount > 0)               
{
    <span class = "cart-badge" > @cartItemCount</span>
                
}

            </a>
        </div>
    </div>
</nav>

@code
{
    private bool collapseNavMenu = true ;

    private int cartItemCount = 0 ;
    
    private string NavMenuCssClass => collapseNavMenu ? "collapsed" : "";

    protected override void OnInitialized()
    {
        CartService.OnChange += UpdateCartCount;
        UpdateCartCount();
    }

    private void UpdateCartCount()
    {
        cartItemCount = CartService.ItemCount;
        StateHasChanged();
    }

    private void ToggleNavMenu()
    {
        collapseNavMenu =!collapseNavMenu;
    }

    private void CloseNavMenu()
    {
        collapseNavMenu = true;
    }

    public void Dispose()
    {
        CartService.OnChange -= UpdateCartCount;
    }
}

<style>
    .navbar {
        background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    .nav-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .nav-brand {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
    }

    .nav-brand i {
        font-size: 1.8rem;
        color: #fbbf24;
    }

    .nav-logo {
        height: 50px;
        width: auto;
        transition: transform 0.3s ease;
    }
    
    .nav-toggle {
        display: none;
        background: none;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
    }

    .nav-menu {
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    .nav-link {
        color: white;
        text-decoration: none;
        padding: 0.75rem 1.25rem;
        border-radius: 5px;
        transition: all 0.3s;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .nav-link:hover {
        background: rgba(255,255,255,0.1);
    }

    .cart-link {
        background: #fbbf24;
        color: #1e3a8a;
        position: relative;
    }

    .cart-link:hover {
        background: #f59e0b;
    }

    .cart-badge {
        background: #ef4444;
        color: white;
        border-radius: 50%;
        padding: 2px 8px;
        font-size: 0.75rem;
        font-weight: bold;
    }

    @@media (max-width: 968px) {
        .nav-toggle {
            display: block;
        }

        .nav-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1e3a8a;
            flex-direction: column;
            padding: 1rem;
            gap: 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .nav-menu.collapsed {
            display: none;
        }

        .nav-link {
            width: 100%;
            padding: 1rem;
        }
    }
</style>